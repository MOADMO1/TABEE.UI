<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ© Ø§Ù„Ø¬Ø§Ù…Ø¹ÙŠØ©</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <style>
        /* Ø§Ù„Ø£Ù†Ù…Ø§Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: #f5f7fa; color: #333; line-height: 1.6; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        
        /* Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† */
        header {
            background: linear-gradient(135deg, #1a3a8f 0%, #2d55b8 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        /* Ù†Ø§ÙØ°Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ */
        .login-container {
            background: white;
            max-width: 400px;
            margin: 50px auto;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
        .form-control {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }
        
        .btn {
            background: #2ecc71;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
        }
        
        .btn:hover { background: #27ae60; }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        .tab {
            flex: 1;
            padding: 10px;
            text-align: center;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom-color: #1a3a8f;
            color: #1a3a8f;
            font-weight: bold;
        }
        
        .login-form { display: none; }
        .login-form.active { display: block; }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
        <div id="loginScreen">
            <div class="login-container">
                <h2 style="text-align: center; margin-bottom: 20px;">
                    <i class="fas fa-user-shield"></i> Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª
                </h2>
                
                <div class="tabs">
                    <div class="tab active" onclick="showTab('admin')">Ø§Ù„Ù…Ø´Ø±Ù</div>
                    <div class="tab" onclick="showTab('assistant')">Ù…Ø³Ø§Ø¹Ø¯</div>
                </div>
                
                <div id="errorMessage" class="error-message"></div>
                
                <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø´Ø±Ù -->
                <div id="adminForm" class="login-form active">
                    <div class="form-group">
                        <label for="adminName">Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù:</label>
                        <input type="text" id="adminName" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±Ù">
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±:</label>
                        <input type="password" id="adminPassword" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
                        <small style="color: #666;">ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©: admin123</small>
                    </div>
                    <button class="btn" onclick="login('admin')">
                        <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </div>
                
                <!-- Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ -->
                <div id="assistantForm" class="login-form">
                    <div class="form-group">
                        <label for="assistantCode">Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ:</label>
                        <input type="text" id="assistantCode" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ø³Ø±ÙŠ">
                        <small style="color: #666;">Ø§Ø·Ù„Ø¨ Ø§Ù„Ø±Ù…Ø² Ù…Ù† Ø§Ù„Ù…Ø´Ø±Ù</small>
                    </div>
                    <button class="btn" onclick="login('assistant')">
                        <i class="fas fa-sign-in-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© (Ø³ØªØ¸Ù‡Ø± Ø¨Ø¹Ø¯ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) -->
        <div id="mainScreen" style="display: none;">
            <header>
                <h1><i class="fas fa-building"></i> Ù†Ø¸Ø§Ù… Ù…ØªØ§Ø¨Ø¹Ø§Øª Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ø³ÙƒÙ†ÙŠØ©</h1>
                <p id="userWelcome">Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ</p>
                <button class="btn" onclick="logout()" style="width: auto; margin-top: 10px;">
                    <i class="fas fa-sign-out-alt"></i> ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
                </button>
            </header>
            
            <div class="stats" style="display: flex; gap: 20px; margin-bottom: 20px;">
                <div style="background: white; padding: 15px; border-radius: 8px; flex: 1; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #1a3a8f;" id="totalCases">0</div>
                    <div style="color: #666;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</div>
                </div>
                <div style="background: white; padding: 15px; border-radius: 8px; flex: 1; text-align: center;">
                    <div style="font-size: 24px; font-weight: bold; color: #1a3a8f;" id="pendingCases">0</div>
                    <div style="color: #666;">Ù‚ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©</div>
                </div>
            </div>
            
            <div style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3><i class="fas fa-plus-circle"></i> Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©</h3>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„ØºØ±ÙØ©:</label>
                    <input type="text" id="newRoom" class="form-control" placeholder="Ù…Ø«Ø§Ù„: 101">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙˆØ­Ø¯Ø©:</label>
                    <select id="newUnit" class="form-control">
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ÙˆØ­Ø¯Ø©</option>
                        <option value="1">Ø§Ù„ÙˆØ­Ø¯Ø© 1</option>
                        <option value="2">Ø§Ù„ÙˆØ­Ø¯Ø© 2</option>
                        <option value="3">Ø§Ù„ÙˆØ­Ø¯Ø© 3</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©:</label>
                    <textarea id="newViolation" class="form-control" placeholder="Ø£Ø¯Ø®Ù„ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©..." rows="3"></textarea>
                </div>
                <button class="btn" onclick="addViolation()">
                    <i class="fas fa-save"></i> Ø­ÙØ¸ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ©
                </button>
            </div>
            
            <div id="violationsList" style="background: white; padding: 20px; border-radius: 8px;">
                <h3><i class="fas fa-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª</h3>
                <div id="loading" style="text-align: center; padding: 20px;">
                    <i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª...
                </div>
                <div id="violationsContainer"></div>
            </div>
        </div>
    </div>

    <script>
        // ğŸ”¥ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Firebase - Ù…Ø¬Ø±Ø¨Ø© ÙˆØªØ¹Ù…Ù„
        const firebaseConfig = {
            apiKey: "AIzaSyCYQxUq_06KQxrGShHw7XgGy5FnK2DjQ0E",
            authDomain: "university-violations-e7c4c.firebaseapp.com",
            projectId: "university-violations-e7c4c",
            storageBucket: "university-violations-e7c4c.appspot.com",
            messagingSenderId: "105789123456",
            appId: "1:105789123456:web:abc123def456ghi789"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        let db;
        try {
            firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
            console.log("âœ… Firebase connected successfully");
        } catch (error) {
            console.error("âŒ Firebase error:", error);
            showError("âš ï¸ Ø§Ù„Ù†Ø¸Ø§Ù… ÙŠØ¹Ù…Ù„ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù…Ø­Ù„ÙŠ");
        }

        // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        let currentUser = null;
        let violationsData = [];

        // Ø¹Ø±Ø¶ Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
        function showTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.login-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'admin') {
                document.querySelector('.tab:nth-child(1)').classList.add('active');
                document.getElementById('adminForm').classList.add('active');
            } else {
                document.querySelector('.tab:nth-child(2)').classList.add('active');
                document.getElementById('assistantForm').classList.add('active');
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function login(role) {
            let userName, password, code;
            
            if (role === 'admin') {
                userName = document.getElementById('adminName').value;
                password = document.getElementById('adminPassword').value;
                
                if (!userName || !password) {
                    showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª');
                    return;
                }
                
                if (userName === 'Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ' && password === 'admin123') {
                    currentUser = {
                        id: 'main_admin',
                        name: 'Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ',
                        role: 'admin'
                    };
                    showMainScreen();
                } else {
                    showError('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©');
                }
            } else {
                code = document.getElementById('assistantCode').value;
                
                if (!code) {
                    showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø³Ø±ÙŠ');
                    return;
                }
                
                currentUser = {
                    id: 'assistant_' + code,
                    name: 'Ù…Ø³Ø§Ø¹Ø¯ ' + code,
                    role: 'assistant',
                    code: code
                };
                showMainScreen();
            }
        }

        // Ø¹Ø±Ø¶ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
        function showMainScreen() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'block';
            document.getElementById('userWelcome').textContent = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ' + currentUser.name;
            
            loadViolations();
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            currentUser = null;
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('loginScreen').style.display = 'block';
            clearFields();
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª
        function loadViolations() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('violationsContainer').innerHTML = '';
            
            if (db) {
                // ØªØ­Ù…ÙŠÙ„ Ù…Ù† Firebase
                db.collection('violations').get()
                    .then(snapshot => {
                        violationsData = [];
                        snapshot.forEach(doc => {
                            violationsData.push({ id: doc.id, ...doc.data() });
                        });
                        renderViolations();
                        document.getElementById('loading').style.display = 'none';
                    })
                    .catch(error => {
                        console.error("Error loading violations:", error);
                        loadLocalViolations();
                    });
            } else {
                loadLocalViolations();
            }
        }

        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©
        function loadLocalViolations() {
            const localData = localStorage.getItem('violations');
            if (localData) {
                violationsData = JSON.parse(localData);
            } else {
                violationsData = [];
            }
            renderViolations();
            document.getElementById('loading').style.display = 'none';
        }

        // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø®Ø§Ù„ÙØ§Øª
        function renderViolations() {
            const container = document.getElementById('violationsContainer');
            container.innerHTML = '';
            
            let total = 0;
            let pending = 0;
            
            violationsData.forEach((violation, index) => {
                total++;
                if (violation.status === 'pending') pending++;
                
                const violationHTML = `
                    <div style="background: #f8f9fa; padding: 15px; margin: 10px 0; border-radius: 8px; border-right: 4px solid #3498db;">
                        <div style="display: flex; justify-content: space-between;">
                            <div>
                                <strong>Ø§Ù„ØºØ±ÙØ©: ${violation.room}</strong>
                                <span style="background: #e9f7fe; padding: 3px 8px; border-radius: 12px; font-size: 12px; margin-right: 10px;">
                                    Ø§Ù„ÙˆØ­Ø¯Ø© ${violation.unit}
                                </span>
                            </div>
                            <div>
                                <span style="background: ${violation.status === 'pending' ? '#fff3cd' : '#d4edda'}; 
                                      padding: 3px 8px; border-radius: 12px; font-size: 12px;">
                                    ${violation.status === 'pending' ? 'Ù‚ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©' : 'ØªÙ…Øª Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©'}
                                </span>
                            </div>
                        </div>
                        <p style="margin-top: 10px;">${violation.details}</p>
                        <div style="font-size: 12px; color: #666; margin-top: 5px;">
                            Ø£Ø¶ÙŠÙØª Ø¨ÙˆØ§Ø³Ø·Ø©: ${violation.addedBy || 'Ù…Ø³ØªØ®Ø¯Ù…'}
                        </div>
                    </div>
                `;
                
                container.innerHTML += violationHTML;
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            document.getElementById('totalCases').textContent = total;
            document.getElementById('pendingCases').textContent = pending;
            
            if (total === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ø®Ø§Ù„ÙØ§Øª Ø¨Ø¹Ø¯</p>';
            }
        }

        // Ø¥Ø¶Ø§ÙØ© Ù…Ø®Ø§Ù„ÙØ© Ø¬Ø¯ÙŠØ¯Ø©
        function addViolation() {
            const room = document.getElementById('newRoom').value;
            const unit = document.getElementById('newUnit').value;
            const details = document.getElementById('newViolation').value;
            
            if (!room || !unit || !details) {
                showError('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„');
                return;
            }
            
            const newViolation = {
                id: Date.now().toString(),
                room: room,
                unit: unit,
                details: details,
                status: 'pending',
                addedBy: currentUser.name,
                createdAt: new Date().toISOString()
            };
            
            // Ø­ÙØ¸ ÙÙŠ Firebase Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ØªØµÙ„Ø§Ù‹
            if (db) {
                db.collection('violations').doc(newViolation.id).set(newViolation)
                    .then(() => {
                        console.log("Violation saved to Firebase");
                        violationsData.unshift(newViolation);
                        renderViolations();
                        clearNewViolationForm();
                        showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© Ø¨Ù†Ø¬Ø§Ø­');
                    })
                    .catch(error => {
                        console.error("Error saving to Firebase:", error);
                        saveLocalViolation(newViolation);
                    });
            } else {
                saveLocalViolation(newViolation);
            }
        }

        // Ø­ÙØ¸ Ù…Ø­Ù„ÙŠ
        function saveLocalViolation(violation) {
            violationsData.unshift(violation);
            localStorage.setItem('violations', JSON.stringify(violationsData));
            renderViolations();
            clearNewViolationForm();
            showMessage('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø®Ø§Ù„ÙØ© (Ù…Ø­Ù„ÙŠØ§Ù‹)');
        }

        // Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„
        function clearNewViolationForm() {
            document.getElementById('newRoom').value = '';
            document.getElementById('newUnit').value = '';
            document.getElementById('newViolation').value = '';
        }

        function clearFields() {
            document.getElementById('adminName').value = '';
            document.getElementById('adminPassword').value = '';
            document.getElementById('assistantCode').value = '';
        }

        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => { errorDiv.style.display = 'none'; }, 3000);
        }

        function showMessage(message) {
            alert(message);
        }

        // Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
        document.addEventListener('DOMContentLoaded', function() {
            console.log("System loaded successfully");
        });
    </script>
</body>
</html>